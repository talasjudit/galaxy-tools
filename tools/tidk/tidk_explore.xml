<tool id="tidk_explore" name="tidk explore" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <requirements>
        <requirement type="package" version="0.2.65">tidk</requirement>
    </requirements>
    
    <command detect_errors="exit_code"><![CDATA[
        tidk explore
            #if $length_mode.mode == "range"
                --minimum $length_mode.minimum
                --maximum $length_mode.maximum
            #else
                --length $length_mode.length
            #end if
            --threshold $threshold
            --distance $distance
            '$input_fasta' > '$output_tsv'
    ]]></command>
    
    <inputs>
        <param name="input_fasta" type="data" format="fasta" 
               label="Input FASTA file" 
               help="Genome sequence file to analyse for telomeric repeats"/>
        
        <conditional name="length_mode">
            <param name="mode" type="select" 
                   label="Length specification mode"
                   help="Choose how to specify repeat length to search for">
                <option value="range" selected="true">Range (minimum to maximum)</option>
                <option value="single">Single specific length</option>
            </param>
            <when value="range">
                <param name="minimum" type="integer" value="5"
                       label="Minimum length of substring"
                       help="Minimum length of substring [default: 5]"/>
                <param name="maximum" type="integer" value="12"
                       label="Maximum length of substring" 
                       help="Maximum length of substring [default: 12]"/>
            </when>
            <when value="single">
                <param name="length" type="integer" value="6"
                       label="Length of substring"
                       help="Length of substring"/>
            </when>
        </conditional>
        
        <param name="threshold" type="integer" value="100"
               label="Threshold" 
               help="Positions of repeats are only reported if they occur sequentially in a greater number than the threshold [default: 100]"/>
        
        <param name="distance" type="float" value="0.01" min="0.0" max="0.5"
               label="Distance"
               help="The distance from the end of the chromosome as a proportion of chromosome length. Must range from 0-0.5 [default: 0.01]"/>
    </inputs>
    
    <outputs>
        <data name="output_tsv" format="tabular" 
              label="Telomeric repeats: ${input_fasta.name}"/>
    </outputs>

  <tests>  
    <test>
        <param name="input_fasta" value="test_genome.fasta"/>
        <conditional name="length_mode">
            <param name="mode" value="range"/>
            <param name="minimum" value="5"/>
            <param name="maximum" value="12"/>
        </conditional>
        <param name="threshold" value="10"/>
        <param name="distance" value="0.5"/>
        <output name="output_tsv" file="expected_explore_output.tsv"/>
    </test>
</tests>

    <help><![CDATA[
**tidk explore**

Use a range of kmer sizes to find potential telomeric repeats.
One of either length, or minimum and maximum must be specified.

**Usage:**
::

    tidk explore [OPTIONS] <FASTA>

**Arguments:**
::

    <FASTA>  The input fasta file

**Options:**
::

    -l, --length [<LENGTH>]        Length of substring
    -m, --minimum [<MINIMUM>]      Minimum length of substring [default: 5]
    -x, --maximum [<MAXIMUM>]      Maximum length of substring [default: 12]
    -t, --threshold [<THRESHOLD>]  Positions of repeats are only reported if they occur sequentially in a greater number than the threshold [default: 100]
        --distance [<DISTANCE>]    The distance from the end of the chromosome as a proportion of chromosome length. Must range from 0-0.5. [default: 0.01]

    ]]></help>
    
    <citations>
        <citation type="doi">10.1093/bioinformatics/btaf049</citation>
    </citations>
</tool>